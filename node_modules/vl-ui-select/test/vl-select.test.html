<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <script src="../../@webcomponents/webcomponentsjs/webcomponents-lite.js"></script>
  <script src="../../web-component-tester/browser.js"></script>
  <script src="../node_modules/sinon/pkg/sinon.js"></script>

  <script type="module" src="../vl-select.src.js"></script>
</head>
<body>
<test-fixture id="vl-select-fixture">
  <template>
    <select is="vl-select"/>
  </template>
</test-fixture>

<script>
  suite('vl-select', () => {
    let field, choices;

    setup((done) => {
      field = fixture('vl-select-fixture');
      choices = {
        element: field,
        setChoices: sinon.spy()
      };
      window.vl = {
        select: {
          dress: sinon.fake(),
          undress: sinon.fake(),
          enable: sinon.fake(),
          disable: sinon.fake(),
          removeActive: sinon.fake(),
          setValueByChoice: sinon.fake()
        },
        util: {
          each: (instances, callback) => {
            callback(choices);
          }
        }
      };

      customElements.whenDefined('vl-select').then(done);
    });

    test('heeft de vl-select class', () => {
      assert.isTrue(field.classList.contains('vl-select'));
    });

    test('krijgt de juiste class wanneer het element een correct attribuut bevat', () => {
      ['block', 'error', 'success', 'disabled'].forEach((attribuut) => {
        assert.isFalse(field.classList.contains('vl-select--' + attribuut));
        field.setAttribute(attribuut, '');
        assert.isTrue(field.classList.contains('vl-select--' + attribuut));
        field.removeAttribute(attribuut);
        assert.isFalse(field.classList.contains('vl-select--' + attribuut));
      });
    });

    test('krijgt geen class wanneer het veld een onbeschikbaar attribuut bevat', () => {
      const attribuut = 'onbeschikbaarattribuut';
      field.setAttribute(attribuut, '');
      assert.isFalse(field.classList.contains('vl-select--' + attribuut));
    });

    test('de dress methode callt vl.select.dress', () => {
      field.dress();
      assert(window.vl.select.dress.calledWith(field));
    });

    test('de dress methode callt vl.select.dress niet als dressed attribuut al gezet is', () => {
      field.setAttribute('data-vl-select-dressed', 'true');
      field.dress();
      assert(window.vl.select.dress.notCalled);
    });

    test('de dress methode met params callt vl.select.dress met params', () => {
      let params = {callbackFn: () => {}};
      field.dress(params);
      assert(window.vl.select.dress.calledWith(field, params));
    });

    test('de undress methode callt vl.select.undress niet als dressed atribuut niet is gezet', () => {
      field.undress();
      assert(window.vl.select.undress.notCalled);
    });

    test('de undress methode callt vl.select.undress met de choices instantie enkel als dressed atribuut is gezet', () => {
      field.setAttribute('data-vl-select-dressed', 'true');
      field.undress();
      assert(window.vl.select.undress.calledWith(choices));
    });

    test('de enable methode callt vl.select.enable', () => {
      field.enable();
      assert(window.vl.select.enable.calledWith(field));
    });

    test('de disable methode callt vl.select.enable', () => {
      field.disable();
      assert(window.vl.select.disable.calledWith(field));
    });

    test('de removeActive methode callt vl.select.removeActive', () => {
      field.removeActive();
      assert(window.vl.select.removeActive.calledWith(field));
    });

    test('de setValueByChoice methode callt vl.select.setValueByChoice', () => {
      field.setValueByChoice('test123');
      assert(window.vl.select.setValueByChoice.calledWith(field, 'test123'));
    });

    test('de mogelijkheden kunnen achteraf nog bepaald worden', () => {
      const data = [{
        value: 'test value',
        label: 'test label'
      }];
      field.choices = data;
      assert(choices.setChoices.calledWith(data, 'value', 'label', true));
    });

    test('bij het toevoegen van een select element aan de DOM zal de dress functie aangeroepen worden zodat de select functionaliteit geactiveerd wordt', (done) => {
      window.vl = {
        select: {
          dress: () => {
            done();
          }
        }
      };
      const newSelect = document.createElement('select', {is: 'vl-select'});
      newSelect.setAttribute('data-vl-select', '');
      document.body.appendChild(newSelect);
    });
  });
</script>
</body>
</html>